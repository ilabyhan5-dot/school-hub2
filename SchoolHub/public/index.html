<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–®–∫–æ–ª—å–Ω—ã–π –•–∞–± - –ò–¥–µ–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: #3A86FF; color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .btn { background: #3A86FF; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
        .idea-card { background: white; padding: 20px; margin: 10px 0; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .deleted { opacity: 0.6; background: #ffebee; border-left: 4px solid #f44336; }
        .deleted-badge { background: #f44336; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8em; margin-left: 10px; }
        .admin-controls { margin-top: 10px; }
        .btn-danger { background: #f44336; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéì –®–∫–æ–ª—å–Ω—ã–π –•–∞–±</h1>
            <p>–ü—Ä–µ–¥–ª–æ–∂–∏—Ç–µ –∏–¥–µ–∏ –¥–ª—è —à–∫–æ–ª—å–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</p>
        </div>

        <div id="authSection">
            <h2>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
            <input type="text" id="username" placeholder="–õ–æ–≥–∏–Ω" value="superadmin">
            <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" value="super123">
            <button onclick="login()">–í–æ–π—Ç–∏</button>
            <p>–¢–µ—Å—Ç–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã: superadmin/super123, admin/admin123</p>
        </div>

        <div id="appSection" style="display: none;">
            <button onclick="logout()">–í—ã–π—Ç–∏</button>
            <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <span id="userName"></span>!</h2>
            
            <div id="adminPanel" style="display: none;">
                <h3>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
                <button onclick="showDeleted = !showDeleted; loadIdeas()">
                    –ü–æ–∫–∞–∑–∞—Ç—å —É–¥–∞–ª–µ–Ω–Ω—ã–µ: <span id="showDeletedText">–ù–ï–¢</span>
                </button>
            </div>

            <h3>–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∏–¥–µ—é</h3>
            <input type="text" id="ideaTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∏–¥–µ–∏">
            <select id="ideaCategory">
                <option value="sport">–°–ø–æ—Ä—Ç</option>
                <option value="art">–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ</option>
                <option value="science">–ù–∞—É–∫–∞</option>
                <option value="charity">–ë–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</option>
                <option value="entertainment">–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</option>
                <option value="other">–î—Ä—É–≥–æ–µ</option>
            </select>
            <textarea id="ideaDescription" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∏–¥–µ–∏"></textarea>
            <label><input type="checkbox" id="anonymous"> –ê–Ω–æ–Ω–∏–º–Ω–æ</label>
            <button onclick="createIdea()">–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∏–¥–µ—é</button>

            <h3>–ò–¥–µ–∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞</h3>
            <div id="ideasList"></div>
        </div>
    </div>

    <script>
        const API_BASE = '/api';
        let currentUser = null;
        let showDeleted = false;

        async function apiCall(endpoint, options = {}) {
            try {
                const response = await fetch(API_BASE + endpoint, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });
                return await response.json();
            } catch (error) {
                alert('–û—à–∏–±–∫–∞: ' + error.message);
                throw error;
            }
        }

        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            try {
                const result = await apiCall('/login', {
                    method: 'POST',
                    body: JSON.stringify({ username, password })
                });

                if (result.error) {
                    alert(result.error);
                    return;
                }

                currentUser = result.user;
                document.getElementById('authSection').style.display = 'none';
                document.getElementById('appSection').style.display = 'block';
                document.getElementById('userName').textContent = currentUser.name;
                
                if (currentUser.role === 'superadmin' || currentUser.role === 'admin') {
                    document.getElementById('adminPanel').style.display = 'block';
                }

                loadIdeas();
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞');
            }
        }

        function logout() {
            currentUser = null;
            document.getElementById('authSection').style.display = 'block';
            document.getElementById('appSection').style.display = 'none';
        }

        async function loadIdeas() {
            try {
                const endpoint = showDeleted ? '/ideas?showDeleted=true' : '/ideas';
                const ideas = await apiCall(endpoint);
                renderIdeas(ideas);
                document.getElementById('showDeletedText').textContent = showDeleted ? '–î–ê' : '–ù–ï–¢';
            } catch (error) {
                console.error('Error loading ideas:', error);
            }
        }

        function renderIdeas(ideas) {
            const container = document.getElementById('ideasList');
            container.innerHTML = '';

            ideas.forEach(idea => {
                const div = document.createElement('div');
                div.className = `idea-card ${idea.status === 'deleted' ? 'deleted' : ''}`;
                
                div.innerHTML = `
                    <h4>${idea.title}</h4>
                    <p>–ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${idea.category} ${idea.status === 'deleted' ? '<span class="deleted-badge">–£–î–ê–õ–ï–ù–û</span>' : ''}</p>
                    <p>${idea.description}</p>
                    <p>üë§ ${idea.author} | üëç ${idea.votes} –≥–æ–ª–æ—Å–æ–≤</p>
                    ${idea.status !== 'deleted' ? `<button onclick="voteForIdea('${idea.id}')">üëç –ü—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞—Ç—å</button>` : ''}
                    ${currentUser && currentUser.role === 'superadmin' && idea.status !== 'deleted' ? `
                        <div class="admin-controls">
                            <button class="btn-danger" onclick="deleteIdea('${idea.id}')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    ` : ''}
                    ${currentUser && currentUser.role === 'superadmin' && idea.status === 'deleted' ? `
                        <div class="admin-controls">
                            <button onclick="restoreIdea('${idea.id}')">‚Üª –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                        </div>
                    ` : ''}
                `;
                container.appendChild(div);
            });
        }

        async function createIdea() {
            const title = document.getElementById('ideaTitle').value;
            const category = document.getElementById('ideaCategory').value;
            const description = document.getElementById('ideaDescription').value;
            const anonymous = document.getElementById('anonymous').checked;

            if (!title || !description) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ');
                return;
            }

            try {
                await apiCall('/ideas', {
                    method: 'POST',
                    body: JSON.stringify({
                        title,
                        category,
                        description,
                        author: currentUser.name,
                        anonymous
                    })
                });

                document.getElementById('ideaTitle').value = '';
                document.getElementById('ideaDescription').value = '';
                loadIdeas();
                alert('–ò–¥–µ—è –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏–¥–µ–∏');
            }
        }

        async function voteForIdea(ideaId) {
            try {
                await apiCall(`/ideas/${ideaId}`, {
                    method: 'POST',
                    body: JSON.stringify({ voter: currentUser.username })
                });
                loadIdeas();
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è');
            }
        }

        async function deleteIdea(ideaId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∏–¥–µ—é?')) return;
            
            try {
                await apiCall(`/ideas/${ideaId}`, { method: 'DELETE' });
                loadIdeas();
                alert('–ò–¥–µ—è —É–¥–∞–ª–µ–Ω–∞');
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è');
            }
        }

        async function restoreIdea(ideaId) {
            try {
                await apiCall(`/ideas/${ideaId}`, { method: 'PATCH' });
                loadIdeas();
                alert('–ò–¥–µ—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞');
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è');
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        setTimeout(() => {
            if (!currentUser) {
                document.getElementById('username').value = 'superadmin';
                document.getElementById('password').value = 'super123';
            }
        }, 1000);
    </script>
</body>
</html>